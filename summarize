#!/usr/bin/env python

# summarize file.csv

import os.path
import csv
import sys
import statistics

def read_file(fname, data):
    print("Loading data from %s" % fname)
    first = True
    with open(fname, 'r') as f:
        reader = csv.reader(f)
        for row in reader:
            if first:
                i = row.index('')
                first = False
            val = row[i-1]
            ndx = tuple(row[:i-1])
            if not ndx in data:
                data[ndx] = []
            data[ndx].append( float(val) )


data = {}

fname = 'benchmarks/%s_results.csv' % sys.argv[1]
if os.path.exists(fname):
    read_file(fname, data)
else:
    fname = 'benchmarks/%s_releases.csv' % sys.argv[1]
    if os.path.exists(fname):
        read_file(fname, data)
    fname = 'benchmarks/%s_branches.csv' % sys.argv[1]
    if os.path.exists(fname):
        read_file(fname, data)


with open('benchmarks/%s.csv' % sys.argv[1], 'w') as csvfile:
    writer = csv.writer(csvfile, delimiter=',')
    for ndx in sorted(data.keys()):
        values = data[ndx]
        writer.writerow( list(ndx) + [min(values), statistics.mean(values), max(values), 0 if len(values) == 1 else statistics.stdev(values)] )

